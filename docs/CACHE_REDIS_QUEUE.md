# 캐시를 이용한 성능 개선

## 개요

콘서트 예약 프로젝트에서 API 응답 속도를 높이고 서버 부하를 줄이기 위해 캐시를 적용했습니다. 이번 작업을 위해 먼저 캐시의 기본 개념과 다양한 캐싱 전략을 학습했고, 관련
내용을 [캐시(Cache)와 캐싱 전략(Caching Strategy)](https://penguin-dev.tistory.com/24)에 정리했습니다.

## 콘서트 예약 프로젝트에서의 캐싱 적용

콘서트 예약 프로젝트에서 캐싱을 통해 성능을 개선할 수 있는 부분들을 검토했습니다. 여기서 목표는 대규모 트래픽이 몰렸을 때 서버 부하를 최대한 줄이고, 빠른 응답 속도를 유지하는
것이었습니다.

1. **콘서트와 콘서트 스케줄 상세 정보**  
   콘서트 정보와 스케줄 정보는 자주 변하지 않는 데이터이면서 조회수가 많아, 캐싱이 적합하다고 판단했습니다. 이 데이터를 캐시하면 매번 DB에 접근할 필요가 없어 조회 속도가
   크게 향상됩니다.

2. **예약 가능한 스케줄 목록**  
   LocalDateTime 기준으로 실시간 업데이트가 필요한 데이터로, 캐싱을 적용할 경우 캐시 갱신이 잦아 쓰기 비용이 증가할 수 있습니다. 따라서 캐싱보다는 적절한 인덱스를
   통해 조회 속도를 개선하는 것이 더 효율적이라고 판단했습니다.

3. **대기열 조회**  
   대기열에서 내 대기 번호를 확인하기 위해 Count(집계 함수)를 사용하는데, 이 과정에서 캐시를 적용하면 성능을 개선할 수 있습니다. 이 정보는 영구적으로 저장할 필요가
   없기 때문에 메모리 기반 관리가 적합하다고 판단했습니다.

추가로 유저 정보, 예약 정보, 결제 정보 등은 트래픽 집중 구간이 아니어서 캐시 히트율이 낮을 것으로 예상했고, 좌석 정보의 경우도 데이터 변화가 잦아 캐싱하지 않기로 했습니다.

## 캐싱 구현

### 캐싱 전략 및 기술 선택

콘서트 및 스케줄 정보 캐싱을 위해 `spring-boot-starter-data-redis`를 활용해 Redis 기반 캐싱을 구현했습니다. Redis는 빠른 처리 속도와 다양한
데이터 구조 지원 덕분에 실시간 트래픽 상황에서 성능을 최적화하는 데 유리합니다. 또한, 비즈니스 로직에서 RedisTemplate을 직접 사용하는 것은 SRP(단일 책임 원칙)에
어긋날 수 있어 Spring Boot의 `@Cacheable` 어노테이션을 사용하여 코드의 간결함과 유지보수성을 높였습니다.

### 캐싱 전략: Look-Aside 캐싱

이번 프로젝트에는 Look-Aside(혹은 Lazy Loading) 캐싱 전략을 도입하여 성능을 최적화했습니다. Look-Aside 캐싱은 요청 시 캐시에서 먼저 데이터를
조회하고, 캐시에 데이터가 없으면 데이터 소스(DB)에서 가져와 캐시에 저장하는 방식입니다. 이 전략은 캐시 적중률을 높이면서도 데이터 일관성을 유지하는 데 유리하며, 자주
조회되지만 자주 변경되지 않는 콘서트와 스케줄 상세 정보와 같은 데이터에 적합합니다.

캐싱 과정은 다음과 같습니다.

1. 클라이언트가 데이터를 요청하면 먼저 캐시를 확인합니다.
2. 캐시에 데이터가 없으면 DB에서 조회한 후, 조회한 데이터를 캐시에 저장합니다.
3. 이후 동일한 데이터 요청이 있을 경우, 캐시에서 데이터를 반환하여 응답 속도를 높입니다.

Look-Aside 전략을 통해 데이터 요청의 속도를 향상시키고 서버 자원의 사용 효율을 높였습니다.

### TODO: STEP14 - 대기열 성능 개선

대기열 성능 개선 작업은 다음 과제에서 진행할 예정입니다.